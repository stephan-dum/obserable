{"version":3,"sources":["lib/observable.js","lib/array.js","lib/proxy.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["const EventEmitter = require('events');\n\nclass ObservableEmitter extends EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\n    this.eventQueue = {};\n\t}\n\ton(event, listener) {\n\t\tsuper.on(event, listener)\n\n    let queue = this.eventQueue[event]\n\n    if(queue) {\n      queue.forEach((args) => {\n        this.emit(event, ...args)\n      })\n    }\n\n    return this;\n\t}\n\temit(event, ...args) {\n\t\tvar listeners = this._events[event];\n\n\t\tif(!listeners || Array.isArray(listeners) && listeners.length == 0) {\n\t\t\tlet queue = this.eventQueue[event];\n\n\t\t\tif(!queue) {\n\t\t\t\tqueue = this.eventQueue[event] = [];\n\t\t\t}\n\n      queue.push(args);\n\t\t} else {\n\t\t\tsuper.emit(event, ...args);\n\t\t}\n\t}\n}\n\nexport default ObservableEmitter;\n","import ObservableEmitter  from \"./observable.js\";\nconst proxyClass = require(\"@aboutweb/proxyclass\");\n\nclass ArrayEmitter extends proxyClass.hasInstance(Array, ObservableEmitter) {\n  constructor(...data) {\n    super();\n\n    if(data) {\n      this.push(...data);\n    }\n  }\n  push(...args) {\n    super.push(...args);\n    this.emit(\"push\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  pop() {\n    let elem = super.pop();\n\n    this.emit(\"pop\", elem);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elem;\n  }\n  splice(...args) {\n    let elems = super.splice(...args);\n\n    this.emit(\"splice\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elems;\n  }\n  unshift(...args) {\n    super.unshift(...args);\n\n    this.emit(\"unshift\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  shift() {\n    let elem = super.shift();\n\n    this.emit(\"shift\");\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elem;\n  }\n\n  set(newValue) {\n    while(super.pop()) {}\n    super.push(...newValue);\n\n    this.emit(\"set\", this);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  static get [Symbol.species]() { return Array; }\n}\n\nexport default ArrayEmitter;\n","import ObservableEmitter  from \"./observable.js\";\n\nclass ObserableProxy extends ObservableEmitter {\n  constructor(data = {}) {\n    super();\n\n    let self = this;\n    this.anyChanges = [];\n    this.data = data;\n\n    return this.proxy = new Proxy(data, {\n      get(target, property) {\n        let value = self[property]\n\n        if(property in self) {\n          return self[property];\n        }\n\n        return data[property];\n      },\n      set(target, property, value) {\n        if(property in self) {\n          return Reflect.set(self, property, value);\n        }\n\n        let curr = target[property];\n\n        if(curr == value) {\n          return true;\n        }\n\n        if(curr instanceof ObservableEmitter) {\n          if(curr.set(value).length == 0) {\n            return true;\n          }\n        } else {\n          Reflect.set(target, property, value);\n        }\n\n        self.anyChanges.forEach((anyChange) => {\n          if(anyChange.properties.indexOf(property) >= 0) {\n            anyChange.listener.call(self.proxy, [property]);\n          }\n        });\n\n        self.emit(\"change$\"+property, value);\n        self.emit(\"change\", property, value);\n\n\n        return true;\n      },\n      defineProperty(target, property, descriptor) {\n        let curr = target[property];\n\n        Reflect.defineProperty(target, property, descriptor);\n\n        self.anyChanges.forEach((anyChange) => {\n          if(anyChange.properties.indexOf(property) >= 0) {\n            anyChange.listener.call(self.proxy, [property]);\n          }\n        });\n\n        self.emit(\"change$\"+property, value);\n        self.emit(\"change\", prop, value);\n\n        return true;\n      },\n      deleteProperty(target, property) {\n        Reflect.deleteProperty(target, property);\n        self.emit(\"delete$\"+property)\n        self.emit(\"delete\", property);\n        return true;\n      }\n    });\n  }\n  any(properties, listener) {\n    this.anyChanges.push({\n      properties, listener\n    });\n  }\n  assign(value, mode = \"assign\") {\n    let data = this.data;\n\n    let changes = [];\n\n    for(let property in value) {\n      let curr = data[property];\n\n      if(curr == value[property]) {\n        continue;\n      }\n\n      if(curr && curr[mode]) {\n        if(curr[mode](value[property], mode).length == 0) {\n          continue;\n        }\n      } else {\n        curr = data[property] = value[property];\n      }\n\n      changes.push(property);\n      this.emit(\"change$\"+property, curr);\n    }\n\n    this.anyChanges.forEach((anyChange) => {\n      let matches = anyChange.properties.filter(\n        (property) => changes.indexOf(property) >= 0\n      );\n\n      if(matches.length) {\n        anyChange.listener.call(this.proxy, matches);\n      }\n    });\n\n    return changes;\n  }\n  set(value) {\n    Object.keys(this.data).forEach((property) => {\n      if(!(property in value)) {\n        delete this[property];\n      }\n    });\n\n    return this.assign(value, \"set\");\n  }\n}\n\nexport default ObserableProxy;\n"]}