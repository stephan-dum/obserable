{"version":3,"file":"index.js","sources":["lib/observable.js","lib/array.js","lib/proxy.js"],"sourcesContent":["const EventEmitter = require('events');\n\nclass ObservableEmitter extends EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\n    this.eventQueue = {};\n\t}\n\ton(event, listener) {\n\t\tsuper.on(event, listener)\n\n    let queue = this.eventQueue[event]\n\n    if(queue) {\n      queue.forEach((args) => {\n        this.emit(event, ...args)\n      })\n    }\n\n    return this;\n\t}\n\temit(event, ...args) {\n\t\tvar listeners = this._events[event];\n\n\t\tif(!listeners || Array.isArray(listeners) && listeners.length == 0) {\n\t\t\tlet queue = this.eventQueue[event];\n\n\t\t\tif(!queue) {\n\t\t\t\tqueue = this.eventQueue[event] = [];\n\t\t\t}\n\n      queue.push(args);\n\t\t} else {\n\t\t\tsuper.emit(event, ...args);\n\t\t}\n\t}\n}\n\nexport default ObservableEmitter;\n","import ObservableEmitter  from \"./observable.js\";\nconst proxyClass = require(\"@aboutweb/proxyclass\");\n\nclass ArrayEmitter extends proxyClass.hasInstance(Array, ObservableEmitter) {\n  constructor(...data) {\n    super();\n\n    if(data) {\n      this.push(...data);\n    }\n  }\n  push(...args) {\n    super.push(...args);\n    this.emit(\"push\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  pop() {\n    let elem = super.pop();\n\n    this.emit(\"pop\", elem);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elem;\n  }\n  splice(...args) {\n    let elems = super.splice(...args);\n\n    this.emit(\"splice\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elems;\n  }\n  unshift(...args) {\n    super.unshift(...args);\n\n    this.emit(\"unshift\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  shift() {\n    let elem = super.shift();\n\n    this.emit(\"shift\");\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elem;\n  }\n\n  set(newValue) {\n    while(super.pop()) {}\n    super.push(...newValue);\n\n    this.emit(\"set\", this);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  static get [Symbol.species]() { return Array; }\n}\n\nexport default ArrayEmitter;\n","import ObservableEmitter  from \"./observable.js\";\n\nclass ObserableProxy extends ObservableEmitter {\n  constructor(data = {}) {\n    super();\n\n    let self = this;\n    this.anyChanges = [];\n    this.data = data;\n\n    return this.proxy = new Proxy(data, {\n      get(target, property) {\n        let value = self[property]\n\n        if(property in self) {\n          return self[property];\n        }\n\n        return data[property];\n      },\n      set(target, property, value) {\n        if(property in self) {\n          return Reflect.set(self, property, value);\n        }\n\n        let curr = target[property];\n\n        if(curr == value) {\n          return true;\n        }\n\n        if(curr instanceof ObservableEmitter) {\n          if(curr.set(value).length == 0) {\n            return true;\n          }\n        } else {\n          Reflect.set(target, property, value);\n        }\n\n        self.anyChanges.forEach((anyChange) => {\n          if(anyChange.properties.indexOf(property) >= 0) {\n            anyChange.listener.call(self.proxy, [property]);\n          }\n        });\n\n        self.emit(\"change$\"+property, value);\n        self.emit(\"change\", property, value);\n\n\n        return true;\n      },\n      defineProperty(target, property, descriptor) {\n        let curr = target[property];\n\n        Reflect.defineProperty(target, property, descriptor);\n\n        self.anyChanges.forEach((anyChange) => {\n          if(anyChange.properties.indexOf(property) >= 0) {\n            anyChange.listener.call(self.proxy, [property]);\n          }\n        });\n\n        self.emit(\"change$\"+property, value);\n        self.emit(\"change\", prop, value);\n\n        return true;\n      },\n      deleteProperty(target, property) {\n        Reflect.deleteProperty(target, property);\n        self.emit(\"delete$\"+property)\n        self.emit(\"delete\", property);\n        return true;\n      }\n    });\n  }\n  any(properties, listener) {\n    this.anyChanges.push({\n      properties, listener\n    });\n  }\n  assign(value, mode = \"assign\") {\n    let data = this.data;\n\n    let changes = [];\n\n    for(let property in value) {\n      let curr = data[property];\n\n      if(curr == value[property]) {\n        continue;\n      }\n\n      if(curr && curr[mode]) {\n        if(curr[mode](value[property], mode).length == 0) {\n          continue;\n        }\n      } else {\n        curr = data[property] = value[property];\n      }\n\n      changes.push(property);\n      this.emit(\"change$\"+property, curr);\n    }\n\n    this.anyChanges.forEach((anyChange) => {\n      let matches = anyChange.properties.filter(\n        (property) => changes.indexOf(property) >= 0\n      );\n\n      if(matches.length) {\n        anyChange.listener.call(this.proxy, matches);\n      }\n    });\n\n    return changes;\n  }\n  set(value) {\n    Object.keys(this.data).forEach((property) => {\n      if(!(property in value)) {\n        delete this[property];\n      }\n    });\n\n    return this.assign(value, \"set\");\n  }\n}\n\nexport default ObserableProxy;\n"],"names":[],"mappings":"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"}