{"version":3,"file":"index.js","sources":["lib/observable.js","lib/array.js","lib/object.js","lib/proxy.js"],"sourcesContent":["const EventEmitter = require('events');\n\nclass ObservableEmitter extends EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\n    this.eventQueue = {};\n\t}\n\ton(event, listener) {\n\t\tsuper.on(event, listener)\n\n    let queue = this.eventQueue[event]\n\n    if(queue) {\n      queue.forEach((args) => {\n        this.emit(event, ...args)\n      })\n    }\n\n    return this;\n\t}\n\temit(event, ...args) {\n\t\tvar listeners = this._events[event];\n\n\t\tif(!listeners || listeners.length == 0) {\n\t\t\tlet queue = this.eventQueue[event];\n\n\t\t\tif(!queue) {\n\t\t\t\tqueue = this.eventQueue[event] = [];\n\t\t\t}\n\n      queue.push(args);\n\t\t} else {\n\t\t\tsuper.emit(event, ...args);\n\t\t}\n\t}\n}\n\nexport default ObservableEmitter;\n","import ObservableEmitter  from \"./observable.js\";\nconst proxyClass = require(\"@aboutweb/proxyclass\");\n\nclass ArrayEmitter extends proxyClass.hasInstance(Array, ObservableEmitter) {\n  constructor(...data) {\n    super();\n\n    if(data) {\n      this.push(...data);\n    }\n  }\n  push(...args) {\n    super.push(...args);\n    this.emit(\"push\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  pop() {\n    let elem = super.pop();\n\n    this.emit(\"pop\", elem);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elem;\n  }\n  splice(...args) {\n    let elems = super.splice(...args);\n\n    this.emit(\"splice\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elems;\n  }\n  unshift(...args) {\n    super.unshift(...args);\n\n    this.emit(\"unshift\", ...args);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  shift() {\n    let elem = super.shift();\n\n    this.emit(\"shift\");\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n\n    return elem;\n  }\n\n  set(newValue) {\n    while(super.pop()) {}\n    super.push(...newValue);\n\n    this.emit(\"set\", this);\n    this.emit(\"change$length\", this.length);\n    this.emit(\"change\", this);\n  }\n  static get [Symbol.species]() { return Array; }\n}\n\nexport default ArrayEmitter;\n","import ObservableEmitter  from \"./observable.js\";\n\nclass ObjectEmitter extends ObservableEmitter {\n  constructor(data) {\n    super();\n\n    if(data) {\n      this.subscribe(data);\n    }\n  }\n  subscribe(data) {\n    Object.keys(data).forEach(function(key) {\n      let value = data[key];\n\n      Object.defineProperty(this, key, {\n        enumerable : true,\n        configurable : true,\n        get : function() {\n          return value;\n        },\n        set : (\n          value instanceof ObservableEmitter\n            ?function(newValue) {\n              value.set(newValue);\n              this.emit(\"change$\"+key, newValue);\n            }\n            :function(newValue) {\n              value = newValue;\n              this.emit(\"change$\"+key, newValue);\n            }\n        )\n      });\n    }, this);\n  }\n  unsubscribe(...keys) {\n    keys.forEach(function(key) {\n      delete this[key];\n    }, this);\n  }\n  set(newValue) {\n    this.unsubscribe(...Object.keys(this));\n    this.subscribe(newValue);\n    this.emit(\"set\", this);\n  }\n}\n\nexport default ObjectEmitter;\n","import ObservableEmitter  from \"./observable.js\";\n\nclass ObserableProxy extends ObservableEmitter {\n  constructor(data = {}) {\n    super();\n\n    let self = this;\n\n    //Object.assign(this, data);\n\n    /*Object.defineProperty(data, \"set\", {\n      value : function(value) {\n        Object.keys(this).map(function(prop) {\n          delete this[prop];\n        });\n\n        Object.assign(this, value);\n        this.emit(\"set\", this);\n      }\n    });*/\n    this.data = data;\n\n    return this.proxy = new Proxy(data, {\n      get(target, property) {\n        let value = self[property]\n\n        if(property in self) {\n          return self[property];\n        }\n\n        return data[property];\n      },\n      set(target, property, value) {\n        if(property in self) {\n          return Reflect.set(self, property, value);\n        }\n\n        let curr = target[property];\n\n        if(curr instanceof ObservableEmitter) {\n          curr.set(value);\n        } else {\n          Reflect.set(target, property, value);\n        }\n\n        self.emit(\"change$\"+property, value);\n        self.emit(\"change\", property, value);\n\n        return true;\n      },\n      defineProperty(target, property, descriptor) {\n        let curr = target[property];\n\n        Reflect.defineProperty(target, property, descriptor);\n\n        self.emit(\"change$\"+property, value);\n        self.emit(\"change\", prop, value);\n\n        return true;\n      },\n      deleteProperty(target, property) {\n        Reflect.deleteProperty(target, property);\n        self.emit(\"delete$\"+property)\n        self.emit(\"delete\", property);\n      }\n    })\n  }\n\n  set(value) {\n    Object.keys(this.data).forEach(function(property) {\n      if(!(property in value)) {\n        delete this.proxy[property];\n      }\n    });\n\n    Object.assign(this.proxy, value);\n    this.emit(\"set\", this.proxy);\n  }\n}\n\nexport default ObserableProxy;\n"],"names":[],"mappings":"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"}